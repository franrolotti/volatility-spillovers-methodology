# Avances hasta el 17/12/2025

## Revisión de Cálculo de Realized Measures


Tras recalcular $ReVar, ReCov, ReCov^+, ReCov^-$, observamos consistencia entre las distintas medidas.

### Realized variances (ReVar: diagonal) – summary

| Series |         Mean |            SD |      Min |        Q1 |    Median |         Q3 |          Max |
| ------ | -----------: | ------------: | -------: | --------: | --------: | ---------: | -----------: |
| BZN|ES |  5070.049812 |   5352.802490 |  10.4895 | 1818.3048 | 3452.1524 |  6456.6980 | 5.304283e+04 |
| BZN|FR | 18392.401123 | 308355.502613 | 131.1228 | 2791.6638 | 5358.4056 | 10003.2682 | 1.169718e+07 |
| BZN|PT |  4879.048279 |   5244.339929 |   9.6059 | 1742.1937 | 3299.5098 |  6169.5043 | 5.304283e+04 |

---

### Realized (co)variances (ReCov: vars + covars) – summary

| Series        |         Mean |            SD |        Min |        Q1 |    Median |         Q3 |          Max |
| ------------- | -----------: | ------------: | ---------: | --------: | --------: | ---------: | -----------: |
| BZN|ES        |  5070.049812 |   5352.802490 |    10.4895 | 1818.3048 | 3452.1524 |  6456.6980 | 5.304283e+04 |
| BZN|FR        | 18392.401123 | 308355.502613 |   131.1228 | 2791.6638 | 5358.4056 | 10003.2682 | 1.169718e+07 |
| BZN|FR-BZN|ES |  3315.075506 |   4034.631019 | -3817.8318 | 1109.5449 | 2367.6053 |  4225.8989 | 6.044626e+04 |
| BZN|PT        |  4879.048279 |   5244.339929 |     9.6059 | 1742.1937 | 3299.5098 |  6169.5043 | 5.304283e+04 |
| BZN|PT-BZN|ES |  4803.624908 |   5196.194109 |  -665.4657 | 1713.8974 | 3273.5214 |  6066.2611 | 5.304283e+04 |
| BZN|PT-BZN|FR |  3124.346372 |   3712.517786 | -3817.8318 | 1028.2917 | 2233.8751 |  3991.9538 | 5.132851e+04 |

---

### Positive semicovariances (ReCov⁺) – summary

| Series        |        Mean |            SD |        Min |        Q1 |    Median |        Q3 |          Max |
| ------------- | ----------: | ------------: | ---------: | --------: | --------: | --------: | -----------: |
| BZN|ES        | 2884.228805 |   3160.576286 |     5.1562 |  939.5336 | 1958.9473 | 3728.5170 | 3.695749e+04 |
| BZN|FR        | 9419.748537 | 142151.494701 |    45.2133 | 1508.7405 | 2988.3389 | 5675.2000 | 5.390847e+06 |
| BZN|FR-BZN|ES | 2100.224080 |   2662.511148 | -2684.4110 |  662.2209 | 1456.4026 | 2774.5954 | 4.306259e+04 |
| BZN|PT        | 2764.199398 |   3087.079371 |     0.4871 |  891.3470 | 1862.3135 | 3585.7932 | 3.455649e+04 |
| BZN|PT-BZN|ES | 2737.004386 |   3073.006007 |  -724.2524 |  885.7239 | 1862.6833 | 3538.9309 | 3.455649e+04 |
| BZN|PT-BZN|FR | 1796.881692 |   2387.592636 | -6291.2841 |  514.6382 | 1231.0136 | 2391.0287 | 4.003416e+04 |

---

### Negative semicovariances (ReCov⁻) – summary

| Series        |        Mean |            SD |        Min |        Q1 |    Median |        Q3 |          Max |
| ------------- | ----------: | ------------: | ---------: | --------: | --------: | --------: | -----------: |
| BZN|ES        | 2185.821007 |   2432.677819 |     3.2115 |  775.1867 | 1473.1653 | 2697.6067 | 2.802685e+04 |
| BZN|FR        | 8972.652586 | 166235.249879 |    36.6541 | 1150.5414 | 2189.4653 | 4269.6456 | 6.306334e+06 |
| BZN|FR-BZN|ES | 1214.851426 |   1719.031163 | -5869.4524 |  344.2349 |  833.3905 | 1585.2847 | 2.624154e+04 |
| BZN|PT        | 2114.848881 |   2391.883632 |     3.2115 |  742.0977 | 1405.5704 | 2616.9489 | 2.802685e+04 |
| BZN|PT-BZN|ES | 2066.620522 |   2371.023200 | -1312.3094 |  723.4370 | 1384.9080 | 2524.9713 | 2.802685e+04 |
| BZN|PT-BZN|FR | 1327.464680 |   1717.429260 | -4070.6557 |  385.8252 |  917.5745 | 1701.0394 | 2.623349e+04 |

---

### Sum of ReCov⁺ and ReCov⁻ (ReCov⁺ + ReCov⁻) – summary

| Series        |         Mean |            SD |        Min |        Q1 |    Median |         Q3 |          Max |
| ------------- | -----------: | ------------: | ---------: | --------: | --------: | ---------: | -----------: |
| BZN|ES        |  5070.049812 |   5352.802490 |    10.4895 | 1818.3048 | 3452.1524 |  6456.6980 | 5.304283e+04 |
| BZN|FR        | 18392.401123 | 308355.502613 |   131.1228 | 2791.6638 | 5358.4056 | 10003.2682 | 1.169718e+07 |
| BZN|FR-BZN|ES |  3315.075506 |   4034.631019 | -3817.8318 | 1109.5449 | 2367.6053 |  4225.8989 | 6.044626e+04 |
| BZN|PT        |  4879.048279 |   5244.339929 |     9.6059 | 1742.1937 | 3299.5098 |  6169.5043 | 5.304283e+04 |
| BZN|PT-BZN|ES |  4803.624908 |   5196.194109 |  -665.4657 | 1713.8974 | 3273.5214 |  6066.2611 | 5.304283e+04 |
| BZN|PT-BZN|FR |  3124.346372 |   3712.517786 | -3817.8318 | 1028.2917 | 2233.8751 |  3991.9538 | 5.132851e+04 |

---

### Check: Max absolute difference between ReCov summary and (ReCov⁺ + ReCov⁻) summary

| Stat   | Max abs diff |
| ------ | -----------: |
| Mean   | 9.094947e-13 |
| SD     | 5.820766e-11 |
| Min    | 4.547474e-13 |
| Q1     | 2.273737e-13 |
| Median | 9.094947e-13 |
| Q3     | 3.637979e-12 |
| Max    | 1.862645e-09 |



## Revisión de Cálculo de Spillovers

En esta sección comparo el **rolling TSI** calculado originalmente vs. el recalculado.
En general, los resultados para **ReCov, ReCov⁺ y ReCov⁻** son prácticamente idénticos (diferencias del orden de 1e-4 a 1e-3).

El único caso con discrepancias relevantes es **MHAR–ReVar**, donde aparece una desviación marcada, concentrada especialmente al inicio de la muestra (primer año). 

> **TO DO:** Revisar MHAR–ReVar, ya que el TSI “original” queda más alto en el primer año.

---

### $MHAR$-ReVar rolling TSI (original vs recalculado)

- Common dates: **1077**
- Mean abs diff: **0.160649**
- Diff range: **[-0.000469, 0.895615]**
- Max abs diff: **0.895615**

![mhar-revar-rolling-tsi-original-vs-recalc](images-2025-12-17/mhar-revar-rolling-tsi-original-vs-recalc.png)

**Comentario:** aquí debo revisar porqué tengo la diferencia en el primer año.

---

### $MHAR$-ReCov rolling TSI (original vs recalculated)

- Common dates: **1077**
- Mean abs diff: **0.000258**
- Diff range: **[-0.001853, 0.001998]**
- Max abs diff: **0.001998**

![mhar-recov-rolling-tsi-original-vs-recalc](images-2025-12-17/mhar-recov-rolling-tsi-original-vs-recalc.png)

**Comentario:** diferencias despreciables (≈ 1e-3). Esto valida que el pipeline de ReCov (vars + covars) está consistente.

---

### $MHAR$-ReCov⁺ rolling TSI (original vs recalculated)

- Common dates: **1077**
- Mean abs diff: **0.000108**
- Diff range: **[-0.000594, 0.001186]**
- Max abs diff: **0.001186**

![mhar-recov-pos-rolling-tsi-original-vs-recalc](images-2025-12-17/mhar-recov-pos-rolling-tsi-original-vs-recalc.png)

**Comentario:** La descomposición positiva parece bien implementada.

---

### $MHAR$-ReCov⁻ rolling TSI (original vs recalculated)

- Common dates: **1077**
- Mean abs diff: **0.000088**
- Diff range: **[-0.001822, 0.001112]**
- Max abs diff: **0.001822**

![mhar-recov-neg-rolling-tsi-original-vs-recalc](images-2025-12-17/mhar-recov-neg-rolling-tsi-original-vs-recalc.png)

**Comentario:** también consistente. La diferencia máxima es pequeña (≈ 1e-3), compatible con redondeo o diferencias numéricas menores.



## Preparación de Variables Exógenas

Para las variables exógenas se han utilizado las siguientes fuentes

- **Coal price:** Investing. Coal (API2) CIF ARA (ARGUS-McCloskey) Futures - (MTFc1). Url: https://es.investing.com/commodities/coal-(api2)-cif-ara-futures. (Nota: Como los valores originales están en USD, para convertir a EUR hemos usado USD/EUR Historical Data (Url: https://www.investing.com/currencies/usd-eur-historical-data)).   
- **Natural gas Price (TTF):** Investing. ICE Dutch TTF Natural Gas Futures Historical Data. Url: https://www.investing.com/commodities/ice-dutch-ttf-gas-c1-futures-historical-data
- **CO2 price:** SendeCO2. EU-ETS spot. Url: https://www.sendeco2.com/es/precios-co2
* **IBEX 35 (índice bursátil – nivel en puntos):** Yahoo Finance. *IBEX 35* (**^IBEX**). Url: `https://finance.yahoo.com/quote/%5EIBEX/` (Yahoo Finanzas)
* **CAC 40 (índice bursátil – nivel en puntos):** Yahoo Finance. *CAC 40* (**^FCHI**). Url: `https://finance.yahoo.com/quote/%5EFCHI/` (Yahoo Finanzas)
* **PSI (índice bursátil de Lisboa – nivel en puntos):** Yahoo Finance. *PSI* (**PSI20.LS**). Url: `https://finance.yahoo.com/quote/PSI20.LS/` (Yahoo Finanzas)
* **Load forecast (demanda eléctrica day-ahead, MW; agregada diaria desde hourly):** ENTSO-E Transparency Platform (vía `entsoe-py`, `EntsoePandasClient.query_load_forecast`). Url: `https://transparency.entsoe.eu/` 
* **Commercial scheduled exchanges (interconexiones day-ahead, MW; agregada diaria desde hourly) — *usamos solo net flow*:** ENTSO-E Transparency Platform (vía `entsoe-py`, `EntsoePandasClient.query_scheduled_exchanges(..., dayahead=True)`). Url: `https://transparency.entsoe.eu/` 


### Detalles de las variables exógenas construidas

Las variables exógenas se han construido para tener frecuencia diaria un rango muestral común (2022-05-21 a 2025-04-30) y un formato homogéneo que permita combinarlas con las series endógenas del spillover. 

#### 1. Precios de combustibles y CO₂ (futuros/spot)

Se incorporan tres drivers energéticos habituales para el mercado eléctrico europeo:

* **Carbón (API2 CIF ARA)** desde Investing (serie original en USD) y **convertida a EUR** usando el tipo de cambio USD/EUR. 
* **Gas natural TTF** (ICE Dutch TTF) desde Investing. 
* **CO₂ (EUA, EU-ETS spot)** desde SendeCO2. 

**Tratamiento temporal:** se trabajan como series diarias y, para evitar huecos por fines de semana/no negociación, se aplica **forward fill** en el dataset final (TTF/CO₂/coal). 

---

#### 2. Índices bursátiles (proxy macro/financiera)

Se añaden índices representativos de España/Francia/Portugal:

* **IBEX 35** (^IBEX), **CAC 40** (^FCHI), **PSI** (PSI20.LS), descargados con Yahoo Finance. 

**Normalización de fechas:** las fechas se ajustan al **calendario CET/CEST (Europe/Paris)**. 

---

#### 3. ENTSO-E: demanda (load forecast) y flujos comerciales day-ahead

Estas variables capturan condiciones físicas y comerciales del sistema eléctrico:

**a. Load forecast day-ahead (por área ES/FR/PT)**

* Fuente: ENTSO-E Transparency Platform vía `entsoe-py` (`query_load_forecast`). 
* Agregación diaria: a partir de datos intra-diarios Agregación diaria: a partir de los valores intra-diarios se calcula la potencia media diaria (MW).

  * `load_energy_mw_es`, `load_energy_mw_fr`, `load_energy_mw_pt`.
    que representan la potencia media diaria prevista para cada zona (ES/FR/PT).

**b. Commercial scheduled exchanges (interconexiones) — net flow**

* Fuente: ENTSO-E vía `query_scheduled_exchanges(..., dayahead=True)`. 
* Se descargan ambos sentidos (ES→FR y FR→ES, ES→PT y PT→ES) y se construye un **flujo neto medio** por frontera:

  * `flow_net_mw_es_fr`, `flow_net_mw_es_pt`, etc. 
* Convención: para cada frontera A-B se calcula **A→B − B→A**, de modo que el signo indica el sentido neto (exportador neto desde A hacia B si es positivo). 

---

### 4. Dummy “Excepción Ibérica”

Se crea una variable binaria diaria:

* `iberian_exception = 1` entre **2022-06-15 y 2023-02-26**, y 0 fuera de ese intervalo. 
  En el ensamblado final, los faltantes se rellenan a 0 por construcción (no tiene sentido “ffill” en un dummy). 

---


## Unit root check

### Endogenous: Before first differences

| series              | nobs | adf_stat | adf_pvalue | kpss_stat | kpss_pvalue | decision                   |
|---------------------|-----:|---------:|-----------:|----------:|------------:|----------------------------|
| tsi_mhar_recov_neg  | 1077 |  -0.7278 |     0.8394 |    3.7854 |        0.01 | unit root / non-stationary |
| tsi_mhar_recov_pos  | 1077 |  -0.6529 |     0.8586 |    4.1123 |        0.01 | unit root / non-stationary |
| tsi_mhar_recov      | 1077 |  -1.3489 |     0.6065 |    3.9541 |        0.01 | unit root / non-stationary |
| tsi_mhar_revar      | 1077 |  -2.1480 |     0.2256 |    3.4167 |        0.01 | unit root / non-stationary |

### Endogenous: After first differences


| series               | nobs | adf_stat  | adf_pvalue | kpss_stat | kpss_pvalue | decision                   |
|----------------------|-----:|----------:|-----------:|----------:|------------:|----------------------------|
| d_tsi_mhar_recov_neg | 1076 |  -13.9681 |        0.0 |    0.4728 |      0.0478 | inconclusive / mixed       |
| d_tsi_mhar_recov_pos | 1076 |  -11.4653 |        0.0 |    0.6835 |      0.0150 | inconclusive / mixed       |
| d_tsi_mhar_recov     | 1076 |   -5.0242 |        0.0 |    0.5882 |      0.0237 | inconclusive / mixed       |
| d_tsi_mhar_revar     | 1076 |  -11.8078 |        0.0 |    0.1067 |      0.1000 | stationary (no unit root)  |




### Exogenous: Before first differences

| series             | nobs | adf_stat | adf_pvalue | kpss_stat | kpss_pvalue | decision                   |
|--------------------|-----:|---------:|-----------:|----------:|------------:|----------------------------|
| TTF                | 1441 |  -2.2543 |     0.1871 |    0.4505 |      0.0100 | unit root / non-stationary |
| co2                | 1441 |  -3.1521 |     0.0229 |    0.7558 |      0.0100 | inconclusive / mixed       |
| coal               | 1441 |  -1.5538 |     0.5068 |    0.5172 |      0.0100 | unit root / non-stationary |
| load_energy_mw_es  | 1441 |  -4.2663 |     0.0005 |    0.1914 |      0.0192 | inconclusive / mixed       |
| load_energy_mw_fr  | 1441 |  -3.0405 |     0.0313 |    0.1390 |      0.0629 | stationary (no unit root)  |
| load_energy_mw_pt  | 1441 |  -3.6957 |     0.0042 |    0.1168 |      0.1000 | stationary (no unit root)  |
| flow_net_mw_ES_FR  | 1441 |  -5.3089 |     0.0000 |    0.4534 |      0.0100 | inconclusive / mixed       |
| flow_net_mw_ES_PT  | 1441 |  -3.8600 |     0.0023 |    0.0980 |      0.1000 | stationary (no unit root)  |
| cac_eur_pts        | 1441 |  -2.0117 |     0.2815 |    0.3310 |      0.0100 | unit root / non-stationary |
| ibex_eur_pts       | 1441 |   0.2913 |     0.9769 |    1.1100 |      0.0100 | unit root / non-stationary |
| psi_eur_pts        | 1441 |  -1.8111 |     0.3750 |    0.1425 |      0.0565 | inconclusive / mixed       |



### Exogenous: After first differences

| series          | nobs | adf_stat  | adf_pvalue | kpss_stat | kpss_pvalue | decision                  |
|-----------------|-----:|----------:|-----------:|----------:|------------:|---------------------------|
| d_TTF           | 1440 |  -13.3411 |        0.0 |    0.0708 |         0.1 | stationary (no unit root) |
| d_coal          | 1440 |   -7.9576 |        0.0 |    0.1348 |         0.1 | stationary (no unit root) |
| d_cac_eur_pts   | 1440 |  -40.3742 |        0.0 |    0.0345 |         0.1 | stationary (no unit root) |
| d_ibex_eur_pts  | 1440 |  -26.0407 |        0.0 |    0.2903 |         0.1 | stationary (no unit root) |


### Summary statistics

| series              |      mean |       std |        min |        max |
|---------------------|----------:|----------:|-----------:|-----------:|
| d_tsi_mhar_recov_neg |  0.002599 |  0.207570 |  -1.183689 |   1.492161 |
| d_tsi_mhar_recov_pos |  0.002469 |  0.176195 |  -1.084911 |   1.030624 |
| d_tsi_mhar_recov     |  0.000850 |  0.174010 |  -1.170950 |   1.301299 |
| d_tsi_mhar_revar     |  0.000187 |  0.190516 |  -1.040986 |   1.174769 |
| co2                  | 75.064470 | 10.070930 |   0.000000 |  97.820000 |
| load_energy_mw_es    | 26522.781783 | 2786.371028 | 19154.177083 | 32931.760417 |
| load_energy_mw_fr    | 49235.493421 | 9317.610146 | 33033.333333 | 78012.500000 |
| load_energy_mw_pt    |  5832.096751 |  633.974240 |  3667.666667 |  7535.583333 |
| flow_net_mw_ES_FR    |   311.522769 | 1781.623936 | -3524.333333 |  3608.708333 |
| flow_net_mw_ES_PT    |   992.419635 | 1119.097818 | -2811.975000 |  3391.550000 |
| psi_eur_pts          |  6252.689063 |  358.253212 |  5190.279785 |  6988.330078 |
| d_TTF                |   -0.036256 |  4.743372 |   -66.600000 |   32.200000 |
| d_coal               |   -0.192055 |  4.168365 |   -45.228415 |   35.834461 |
| d_cac_eur_pts        |    1.180883 | 58.027387 |  -347.830078 |  263.000000 |
| d_ibex_eur_pts       |    4.537547 | 84.308715 |  -769.200195 |  510.000000 |
| iberian_exception    |    0.238848 |  0.426578 |    0.000000 |    1.000000 |



## Correlations

### Exog-exog

|                    |      co2 | load_energy_mw_es | load_energy_mw_fr | load_energy_mw_pt | flow_net_mw_ES_FR | flow_net_mw_ES_PT | psi_eur_pts |    d_TTF |   d_coal | d_cac_eur_pts |
|--------------------|---------:|------------------:|------------------:|------------------:|------------------:|------------------:|------------:|---------:|---------:|--------------:|
| co2                | 1.000000 |         -0.005851 |         -0.117395 |         -0.134586 |          0.040108 |          0.075558 |   -0.423373 | 0.045988 | 0.008977 |     -0.016038 |
| load_energy_mw_es  | -0.005851 |          1.000000 |          0.500803 |          0.776102 |          0.013329 |         -0.110777 |    0.050119 | 0.007601 | -0.017232 |      0.019584 |
| load_energy_mw_fr  | -0.117395 |          0.500803 |          1.000000 |          0.770104 |          0.261447 |         -0.421348 |    0.009904 | -0.032519 | -0.035998 |      0.057926 |
| load_energy_mw_pt  | -0.134586 |          0.776102 |          0.770104 |          1.000000 |          0.113829 |         -0.287466 |    0.080080 | -0.015978 | -0.019259 |      0.041379 |
| flow_net_mw_ES_FR  | 0.040108 |          0.013329 |          0.261447 |          0.113829 |          1.000000 |         -0.433977 |   -0.275871 | -0.031808 | -0.003896 |      0.047864 |
| flow_net_mw_ES_PT  | 0.075558 |         -0.110777 |         -0.421348 |         -0.287466 |         -0.433977 |          1.000000 |    0.140138 | 0.037388 | 0.052464 |     -0.025638 |
| psi_eur_pts        | -0.423373 |          0.050119 |          0.009904 |          0.080080 |         -0.275871 |          0.140138 |    1.000000 | 0.058413 | 0.074221 |     -0.008182 |
| d_TTF              | 0.045988 |          0.007601 |         -0.032519 |         -0.015978 |         -0.031808 |          0.037388 |    0.058413 | 1.000000 | 0.168855 |     -0.053412 |
| d_coal             | 0.008977 |         -0.017232 |         -0.035998 |         -0.019259 |         -0.003896 |          0.052464 |    0.074221 | 0.168855 | 1.000000 |     -0.076235 |
| d_cac_eur_pts      | -0.016038 |          0.019584 |          0.057926 |          0.041379 |          0.047864 |         -0.025638 |   -0.008182 | -0.053412 | -0.076235 |      1.000000 |


![Correlation matrix (exog–exog)](images/corr-exog-exog.png)



### Endog-endog

|                    | d_tsi_mhar_recov_neg | d_tsi_mhar_recov_pos | d_tsi_mhar_recov | d_tsi_mhar_revar |
|--------------------|---------------------:|---------------------:|-----------------:|-----------------:|
| d_tsi_mhar_recov_neg | 1.000000 | 0.512596 | 0.718792 | 0.549439 |
| d_tsi_mhar_recov_pos | 0.512596 | 1.000000 | 0.849596 | 0.666366 |
| d_tsi_mhar_recov     | 0.718792 | 0.849596 | 1.000000 | 0.734375 |
| d_tsi_mhar_revar     | 0.549439 | 0.666366 | 0.734375 | 1.000000 |


### Endog-exog 

|                    |      co2 | load_energy_mw_es | load_energy_mw_fr | load_energy_mw_pt | flow_net_mw_ES_FR | flow_net_mw_ES_PT | psi_eur_pts |    d_TTF |   d_coal | d_cac_eur_pts |
|--------------------|---------:|------------------:|------------------:|------------------:|------------------:|------------------:|------------:|---------:|---------:|--------------:|
| d_tsi_mhar_recov_neg | -0.026080 | -0.051429 | -0.037656 | -0.043339 | -0.071887 | -0.059869 | 0.010898 | -0.065357 | -0.010150 | -0.026462 |
| d_tsi_mhar_recov_pos | -0.013715 | -0.046863 | -0.022859 | -0.023234 | -0.093624 | -0.050819 | 0.006696 | -0.035900 | -0.018000 | -0.019453 |
| d_tsi_mhar_recov     | -0.038488 | -0.022500 | -0.021328 | -0.008152 | -0.071242 | -0.073538 | 0.011640 | -0.043296 | -0.033155 | -0.031356 |
| d_tsi_mhar_revar     | -0.021015 | -0.053967 | -0.060713 | -0.040169 | -0.077425 | -0.049821 | -0.014841 | -0.005710 | -0.029004 | -0.038757 |


![Correlation matrix (endog–exog)](images/corr-endog-exog.png)





